<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photobox Sederhana dengan Filter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* CSS Kustom */
        body {
            background-color: #f8f9fa;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border: 5px solid #343a40;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #videoElement {
            width: 100%;
            display: block;
        }

        #canvasElement {
            display: none; /* Awalnya tersembunyi, hanya digunakan untuk pengambilan & filter */
        }

        .output-container {
            min-height: 200px;
            border: 2px dashed #adb5bd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .output-img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* CSS untuk filter (Contoh filter sederhana) */
        .filter-grayscale {
            filter: grayscale(100%);
        }

        .filter-sepia {
            filter: sepia(100%);
        }

        .filter-invert {
            filter: invert(100%);
        }
    </style>
</head>
<body>

    <div class="container my-5">
        <h1 class="text-center mb-4 text-primary">Photobox Filter Sederhana</h1>
        <p class="text-center text-muted">Akses kamera dan terapkan filter menggunakan WebRTC & JavaScript.</p>
        
        <div class="camera-container mb-4">
            <video id="videoElement" autoplay></video>
            <canvas id="canvasElement"></canvas>
        </div>

        <div class="filter-controls text-center mb-4">
            <h5 class="mb-3">Pilih Filter:</h5>
            <div class="btn-group" role="group" aria-label="Filter Controls">
                <button type="button" class="btn btn-dark active" data-filter="none" onclick="applyFilter('none', this)">Normal</button>
                <button type="button" class="btn btn-secondary" data-filter="grayscale" onclick="applyFilter('grayscale', this)">B/W (Grayscale)</button>
                <button type="button" class="btn btn-secondary" data-filter="sepia" onclick="applyFilter('sepia', this)">Sepia</button>
                <button type="button" class="btn btn-secondary" data-filter="invert" onclick="applyFilter('invert', this)">Invert</button>
            </div>
        </div>

        <div class="text-center mb-5">
            <button id="snapButton" class="btn btn-success btn-lg shadow-sm" onclick="takeSnapshot()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-camera-fill me-2" viewBox="0 0 16 16">
                  <path d="M10.5 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0"/>
                  <path d="M12 3a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2H2.5a.5.5 0 1 0 0 1h.5a.5.5 0 0 1 0 1H3a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 0 1H4a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 0 1H5a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 0 1H6a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 0 1H10a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/>
                </svg>
                Ambil Foto
            </button>
        </div>

        <h3 class="text-center mb-3">Hasil Foto</h3>
        <div class="output-container p-4">
            <img id="outputImage" class="output-img" src="" alt="Hasil Foto" style="display: none;">
            <p id="placeholderText">Belum ada foto yang diambil.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const video = document.getElementById('videoElement');
        const canvas = document.getElementById('canvasElement');
        const outputImage = document.getElementById('outputImage');
        const placeholderText = document.getElementById('placeholderText');
        const snapButton = document.getElementById('snapButton');
        let currentFilter = 'none';

        // --- 1. Akses Kamera (WebRTC) ---
        function startCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        video.srcObject = stream;
                        video.play();
                    })
                    .catch(function(err) {
                        alert('Gagal mengakses kamera. Pastikan Anda mengizinkannya. Error: ' + err.name);
                        snapButton.disabled = true;
                    });
            } else {
                alert('Browser Anda tidak mendukung WebRTC (Akses Kamera).');
                snapButton.disabled = true;
            }
        }
        
        // --- 2. Fungsi Menerapkan Filter pada Video (Real-Time) ---
        function applyFilter(filterName, buttonElement) {
            // Hapus semua kelas filter yang mungkin ada
            video.className = ''; 
            
            // Tambahkan kelas filter yang dipilih
            if (filterName !== 'none') {
                video.classList.add(`filter-${filterName}`);
            }
            
            currentFilter = filterName;

            // Perbarui tampilan tombol (active state)
            document.querySelectorAll('.filter-controls .btn').forEach(btn => {
                btn.classList.remove('active', 'btn-dark');
                btn.classList.add('btn-secondary');
            });

            buttonElement.classList.remove('btn-secondary');
            buttonElement.classList.add('active', 'btn-dark');
        }

        // --- 3. Fungsi Ambil Foto dan Terapkan Filter Permanen ---
        function takeSnapshot() {
            // Pastikan video sedang berjalan
            if (!video.srcObject) {
                alert("Kamera belum siap.");
                return;
            }

            const width = video.videoWidth;
            const height = video.videoHeight;
            
            // Set ukuran canvas sama dengan video
            canvas.width = width;
            canvas.height = height;

            const context = canvas.getContext('2d');
            
            // Cek filter yang aktif
            let filterStyle = '';
            if (currentFilter === 'grayscale') {
                filterStyle = 'grayscale(100%)';
            } else if (currentFilter === 'sepia') {
                filterStyle = 'sepia(100%)';
            } else if (currentFilter === 'invert') {
                filterStyle = 'invert(100%)';
            }

            // Terapkan filter ke konteks canvas sebelum menggambar
            context.filter = filterStyle;
            
            // Gambar frame video saat ini ke canvas
            context.drawImage(video, 0, 0, width, height);

            // Ambil data gambar dari canvas
            const dataURL = canvas.toDataURL('image/png'); 

            // Tampilkan hasil foto
            outputImage.src = dataURL;
            outputImage.style.display = 'block';
            placeholderText.style.display = 'none';

            // Opsional: reset filter pada video setelah foto diambil
            // applyFilter('none', document.querySelector('[data-filter="none"]'));

            alert('Foto berhasil diambil dengan filter ' + currentFilter.toUpperCase());
        }

        // Jalankan fungsi saat halaman dimuat
        window.onload = startCamera;
    </script>

</body>
</html>
